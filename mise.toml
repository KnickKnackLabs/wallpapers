# Mise tasks for wallpaper generation
# Uses gum for beautiful CLI interactions
# Swift for zero-dependency image generation

[tasks.generate]
description = "Generate a wallpaper interactively"
run = """
#!/usr/bin/env bash
set -e

# Styled header
gum style \
    --foreground 212 --border-foreground 212 --border double \
    --align center --width 50 --margin "1 2" --padding "1 2" \
    'ðŸ–¼ï¸ Wallpaper Generator'

# Get workspace name
NAME=$(gum input --placeholder "Workspace name (e.g., 'Code', 'Design')" --prompt "ðŸ“ Name: ")

if [ -z "$NAME" ]; then
    gum style --foreground 196 "âŒ Name is required"
    exit 1
fi

# Ask for optional description
DESC_ARG=""
if gum confirm "Add a description?"; then
    DESCRIPTION=$(gum input --placeholder "Brief description" --prompt "ðŸ“‹ Description: ")
    if [ -n "$DESCRIPTION" ]; then
        DESC_ARG="--description"
    fi
fi

# Select resolution
RESOLUTION=$(gum choose --header "ðŸ“ Select resolution:" \
    "1080p (1920x1080)" \
    "1440p (2560x1440)" \
    "4k (3840x2160)" \
    "macbook-14 (3024x1964)" \
    "macbook-16 (3456x2234)" \
    "imac-24 (4480x2520)" \
    "studio-display (5120x2880)")

# Extract just the resolution key
RES_KEY=$(echo "$RESOLUTION" | cut -d' ' -f1)

# Select colors
gum style --foreground 244 "ðŸŽ¨ Color scheme"
BG_COLOR=$(gum choose --header "Background:" \
    "#000000 (Black)" \
    "#1a1a2e (Dark Navy)" \
    "#16213e (Deep Blue)" \
    "#0f3460 (Ocean)" \
    "#2d3436 (Charcoal)" \
    "#ffffff (White)" \
    "custom")

if [ "$BG_COLOR" = "custom" ]; then
    BG_COLOR=$(gum input --placeholder "#000000" --prompt "Custom hex: ")
else
    BG_COLOR=$(echo "$BG_COLOR" | cut -d' ' -f1)
fi

TEXT_COLOR=$(gum choose --header "Text color:" \
    "#ffffff (White)" \
    "#e94560 (Red)" \
    "#00d9ff (Cyan)" \
    "#00ff88 (Green)" \
    "#ffd93d (Yellow)" \
    "#c9b1ff (Lavender)" \
    "custom")

if [ "$TEXT_COLOR" = "custom" ]; then
    TEXT_COLOR=$(gum input --placeholder "#ffffff" --prompt "Custom hex: ")
else
    TEXT_COLOR=$(echo "$TEXT_COLOR" | cut -d' ' -f1)
fi

# Build and run Swift generator
gum spin --spinner dot --title "Generating wallpaper..." -- \
    swift src/generate.swift "$NAME" \
        -r "$RES_KEY" \
        --bg-color "$BG_COLOR" \
        --text-color "$TEXT_COLOR" \
        $DESC_ARG ${DESCRIPTION:+"$DESCRIPTION"}

gum style --foreground 46 "âœ… Wallpaper generated! Check the output/ directory."

# Show the generated files
ls -la output/
"""

[tasks.quick]
description = "Quick generate with just a name"
run = """
#!/usr/bin/env bash
set -e

NAME=$(gum input --placeholder "Workspace name" --prompt "ðŸ“ Quick generate: ")

if [ -z "$NAME" ]; then
    gum style --foreground 196 "âŒ Name is required"
    exit 1
fi

gum spin --spinner dot --title "Generating..." -- \
    swift src/generate.swift "$NAME"

gum style --foreground 46 "âœ… Done! Saved to output/"
"""

[tasks.cli]
description = "Run generator directly with arguments"
run = "swift src/generate.swift"

[tasks.list]
description = "List generated wallpapers"
run = """
#!/usr/bin/env bash
if [ -d output ] && [ "$(ls -A output 2>/dev/null)" ]; then
    gum style --foreground 212 --bold "ðŸ“ Generated Wallpapers:"
    ls -lh output/*.png 2>/dev/null | awk '{print "  " $9 " (" $5 ")"}'
else
    gum style --foreground 244 "No wallpapers generated yet. Run 'mise run generate' to create one."
fi
"""

[tasks.clean]
description = "Remove all generated wallpapers"
run = """
#!/usr/bin/env bash
if gum confirm "Delete all generated wallpapers?"; then
    rm -rf output/*.png
    gum style --foreground 46 "âœ… Cleaned output directory"
else
    gum style --foreground 244 "Cancelled"
fi
"""

[tasks.open]
description = "Open the output directory in Finder"
run = "open output/"

[tasks.help]
description = "Show generator CLI help"
run = "swift src/generate.swift --help"
